"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.skipJsErrorOptions = exports.urlArgument = exports.urlsArgument = exports.setCookiesArgument = exports.cookiesArgument = exports.functionArgument = exports.screenshotPathArgument = exports.resizeWindowDeviceArgument = exports.stringOrStringArrayArgument = exports.pageUrlArgument = exports.nullableStringArgument = exports.nonEmptyStringArgument = exports.stringArgument = exports.actionOptions = exports.actionRoleArgument = exports.setSpeedArgument = exports.booleanArgument = exports.positiveIntegerArgument = exports.integerArgument = void 0;
const device_specs_1 = require("device-specs");
const marker_symbol_1 = __importDefault(require("../../../role/marker-symbol"));
const factories_1 = require("./factories");
const test_run_1 = require("../../../errors/test-run");
const url_1 = require("url");
const test_page_url_1 = require("../../../api/test-page-url");
const check_file_path_1 = __importDefault(require("../../../utils/check-file-path"));
const lodash_1 = require("lodash");
const skip_js_errors_1 = require("../../../api/skip-js-errors");
// Validators
exports.integerArgument = (0, factories_1.createIntegerValidator)(test_run_1.ActionIntegerArgumentError);
exports.positiveIntegerArgument = (0, factories_1.createPositiveIntegerValidator)(test_run_1.ActionPositiveIntegerArgumentError);
exports.booleanArgument = (0, factories_1.createBooleanValidator)(test_run_1.ActionBooleanArgumentError);
exports.setSpeedArgument = (0, factories_1.createSpeedValidator)(test_run_1.SetTestSpeedArgumentError);
function actionRoleArgument(name, val) {
    if (!val || !val[marker_symbol_1.default])
        throw new test_run_1.ActionRoleArgumentError(name, typeof val);
}
exports.actionRoleArgument = actionRoleArgument;
function actionOptions(name, val) {
    const type = typeof val;
    if (type !== 'object' && val !== null && val !== void 0)
        throw new test_run_1.ActionOptionsTypeError(type);
}
exports.actionOptions = actionOptions;
function stringArgument(argument, val, createError) {
    if (!createError)
        createError = actualValue => new test_run_1.ActionStringArgumentError(argument, actualValue);
    const type = typeof val;
    if (type !== 'string')
        throw createError(type);
}
exports.stringArgument = stringArgument;
function nonEmptyStringArgument(argument, val, createError) {
    if (!createError)
        createError = actualValue => new test_run_1.ActionStringArgumentError(argument, actualValue);
    stringArgument(argument, val, createError);
    if (!val.length)
        throw createError('""');
}
exports.nonEmptyStringArgument = nonEmptyStringArgument;
function nullableStringArgument(argument, val) {
    const type = typeof val;
    if (type !== 'string' && val !== null)
        throw new test_run_1.ActionNullableStringArgumentError(argument, type);
}
exports.nullableStringArgument = nullableStringArgument;
function pageUrlArgument(name, val) {
    nonEmptyStringArgument(name, val);
    (0, test_page_url_1.assertPageUrl)(val.trim(), 'navigateTo');
}
exports.pageUrlArgument = pageUrlArgument;
function stringOrStringArrayArgument(argument, val) {
    const type = typeof val;
    if (type === 'string') {
        if (!val.length)
            throw new test_run_1.ActionStringOrStringArrayArgumentError(argument, '""');
    }
    else if (Array.isArray(val)) {
        if (!val.length)
            throw new test_run_1.ActionStringOrStringArrayArgumentError(argument, '[]');
        const validateElement = elementIndex => nonEmptyStringArgument(argument, val[elementIndex], actualValue => new test_run_1.ActionStringArrayElementError(argument, actualValue, elementIndex));
        for (let i = 0; i < val.length; i++)
            validateElement(i);
    }
    else
        throw new test_run_1.ActionStringOrStringArrayArgumentError(argument, type);
}
exports.stringOrStringArrayArgument = stringOrStringArrayArgument;
function resizeWindowDeviceArgument(name, val) {
    nonEmptyStringArgument(name, val);
    if (!(0, device_specs_1.isValidDeviceName)(val))
        throw new test_run_1.ActionUnsupportedDeviceTypeError(name, val);
}
exports.resizeWindowDeviceArgument = resizeWindowDeviceArgument;
function screenshotPathArgument(name, val) {
    nonEmptyStringArgument(name, val);
    const forbiddenCharsList = (0, check_file_path_1.default)(val);
    if (forbiddenCharsList.length)
        throw new test_run_1.ForbiddenCharactersInScreenshotPathError(val, forbiddenCharsList);
}
exports.screenshotPathArgument = screenshotPathArgument;
function functionArgument(name, val) {
    if (typeof val !== 'function')
        throw new test_run_1.ActionFunctionArgumentError(name, val);
}
exports.functionArgument = functionArgument;
function isValidCookie(cookie) {
    return !!cookie && (typeof cookie === 'object' || typeof cookie === 'string');
}
function cookiesArgument(name, val) {
    const cookiesLength = val.length;
    for (const [i, value] of val.entries()) {
        if (!isValidCookie(value)) {
            throw cookiesLength === 1
                ? new test_run_1.ActionCookieArgumentError()
                : new test_run_1.ActionCookieArgumentsError(i, value);
        }
    }
}
exports.cookiesArgument = cookiesArgument;
function setCookiesArgument(name, val) {
    if (!val.length)
        throw new test_run_1.ActionRequiredCookieArguments();
    cookiesArgument(name, val);
}
exports.setCookiesArgument = setCookiesArgument;
function isValidUrl(url) {
    try {
        return new url_1.URL(url) && true;
    }
    catch (_a) {
        return false;
    }
}
function urlsArgument(name, val) {
    const castVal = (0, lodash_1.castArray)(val);
    for (const [i, value] of castVal.entries()) {
        if (!isValidUrl(value)) {
            throw castVal.length === 1
                ? new test_run_1.ActionUrlCookieArgumentError()
                : new test_run_1.ActionUrlsCookieArgumentError(i, value);
        }
    }
}
exports.urlsArgument = urlsArgument;
function urlArgument(name, val) {
    const valType = typeof val;
    if (valType !== 'string' && !(val instanceof url_1.URL))
        throw new test_run_1.ActionUrlArgumentError(name, valType);
}
exports.urlArgument = urlArgument;
function skipJsErrorOptions(name, val) {
    const valType = typeof val;
    if (valType !== 'undefined' && valType !== 'object' && valType !== 'boolean' && valType !== 'function')
        throw new test_run_1.ActionSkipJsErrorsArgumentTypeError(name, valType);
    if ((0, skip_js_errors_1.isSkipJsErrorsCallbackWithOptionsObject)(val) && val.dependencies && typeof val.dependencies !== 'object')
        throw new test_run_1.ActionSkipJsErrorsDependenciesArgumentTypeError('dependencies', typeof dependencies);
}
exports.skipJsErrorOptions = skipJsErrorOptions;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJndW1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvdGVzdC1ydW4vY29tbWFuZHMvdmFsaWRhdGlvbnMvYXJndW1lbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsK0NBQWlEO0FBQ2pELGdGQUEyRDtBQUUzRCwyQ0FLcUI7QUFFckIsdURBc0JrQztBQUVsQyw2QkFBMEI7QUFDMUIsOERBQTJEO0FBQzNELHFGQUEyRDtBQUMzRCxtQ0FBbUM7QUFDbkMsZ0VBQXNGO0FBR3RGLGFBQWE7QUFDQSxRQUFBLGVBQWUsR0FBVyxJQUFBLGtDQUFzQixFQUFDLHFDQUEwQixDQUFDLENBQUM7QUFDN0UsUUFBQSx1QkFBdUIsR0FBRyxJQUFBLDBDQUE4QixFQUFDLDZDQUFrQyxDQUFDLENBQUM7QUFDN0YsUUFBQSxlQUFlLEdBQVcsSUFBQSxrQ0FBc0IsRUFBQyxxQ0FBMEIsQ0FBQyxDQUFDO0FBQzdFLFFBQUEsZ0JBQWdCLEdBQVUsSUFBQSxnQ0FBb0IsRUFBQyxvQ0FBeUIsQ0FBQyxDQUFDO0FBR3ZGLFNBQWdCLGtCQUFrQixDQUFFLElBQUksRUFBRSxHQUFHO0lBQ3pDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsdUJBQWdCLENBQUM7UUFDOUIsTUFBTSxJQUFJLGtDQUF1QixDQUFDLElBQUksRUFBRSxPQUFPLEdBQUcsQ0FBQyxDQUFDO0FBQzVELENBQUM7QUFIRCxnREFHQztBQUVELFNBQWdCLGFBQWEsQ0FBRSxJQUFJLEVBQUUsR0FBRztJQUNwQyxNQUFNLElBQUksR0FBRyxPQUFPLEdBQUcsQ0FBQztJQUV4QixJQUFJLElBQUksS0FBSyxRQUFRLElBQUksR0FBRyxLQUFLLElBQUksSUFBSSxHQUFHLEtBQUssS0FBSyxDQUFDO1FBQ25ELE1BQU0sSUFBSSxpQ0FBc0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUMvQyxDQUFDO0FBTEQsc0NBS0M7QUFHRCxTQUFnQixjQUFjLENB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QUFLLFFBQVEsSUFBSSxPQUFPLEtBQUssU0FBUyxJQUFJLE9BQU8sS0FBSyxVQUFVO1FBQ2xHLE1BQU0sSUFBSSw4Q0FBbUMsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFFakUsSUFBSSxJQUFBLHdEQUF1QyxFQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxZQUFZLElBQUksT0FBTyxHQUFHLENBQUMsWUFBWSxLQUFLLFFBQVE7UUFDeEcsTUFBTSxJQUFJLDBEQUErQyxDQUFDLGNBQWMsRUFBRSxPQUFPLFlBQVksQ0FBQyxDQUFDO0FBQ3ZHLENBQUM7QUFSRCxnREFRQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzVmFsaWREZXZpY2VOYW1lIH0gZnJvbSAnZGV2aWNlLXNwZWNzJztcbmltcG9ydCByb2xlTWFya2VyU3ltYm9sIGZyb20gJy4uLy4uLy4uL3JvbGUvbWFya2VyLXN5bWJvbCc7XG5cbmltcG9ydCB7XG4gICAgY3JlYXRlQm9vbGVhblZhbGlkYXRvcixcbiAgICBjcmVhdGVJbnRlZ2VyVmFsaWRhdG9yLFxuICAgIGNyZWF0ZVBvc2l0aXZlSW50ZWdlclZhbGlkYXRvcixcbiAgICBjcmVhdGVTcGVlZFZhbGlkYXRvcixcbn0gZnJvbSAnLi9mYWN0b3JpZXMnO1xuXG5pbXBvcnQge1xuICAgIEFjdGlvbk9wdGlvbnNUeXBlRXJyb3IsXG4gICAgQWN0aW9uQm9vbGVhbkFyZ3VtZW50RXJyb3IsXG4gICAgQWN0aW9uU3RyaW5nQXJndW1lbnRFcnJvcixcbiAgICBBY3Rpb25OdWxsYWJsZVN0cmluZ0FyZ3VtZW50RXJyb3IsXG4gICAgQWN0aW9uSW50ZWdlckFyZ3VtZW50RXJyb3IsXG4gICAgQWN0aW9uUm9sZUFyZ3VtZW50RXJyb3IsXG4gICAgQWN0aW9uUG9zaXRpdmVJbnRlZ2VyQXJndW1lbnRFcnJvcixcbiAgICBBY3Rpb25TdHJpbmdPclN0cmluZ0FycmF5QXJndW1lbnRFcnJvcixcbiAgICBBY3Rpb25TdHJpbmdBcnJheUVsZW1lbnRFcnJvcixcbiAgICBBY3Rpb25VbnN1cHBvcnRlZERldmljZVR5cGVFcnJvcixcbiAgICBBY3Rpb25GdW5jdGlvbkFyZ3VtZW50RXJyb3IsXG4gICAgU2V0VGVzdFNwZWVkQXJndW1lbnRFcnJvcixcbiAgICBGb3JiaWRkZW5DaGFyYWN0ZXJzSW5TY3JlZW5zaG90UGF0aEVycm9yLFxuICAgIEFjdGlvbkNvb2tpZUFyZ3VtZW50RXJyb3IsXG4gICAgQWN0aW9uQ29va2llQXJndW1lbnRzRXJyb3IsXG4gICAgQWN0aW9uVXJsQ29va2llQXJndW1lbnRFcnJvcixcbiAgICBBY3Rpb25VcmxzQ29va2llQXJndW1lbnRFcnJvcixcbiAgICBBY3Rpb25SZXF1aXJlZENvb2tpZUFyZ3VtZW50cyxcbiAgICBBY3Rpb25VcmxBcmd1bWVudEVycm9yLFxuICAgIEFjdGlvblNraXBKc0Vycm9yc0FyZ3VtZW50VHlwZUVycm9yLFxuICAgIEFjdGlvblNraXBKc0Vycm9yc0RlcGVuZGVuY2llc0FyZ3VtZW50VHlwZUVycm9yLFxufSBmcm9tICcuLi8uLi8uLi9lcnJvcnMvdGVzdC1ydW4nO1xuXG5pbXBvcnQgeyBVUkwgfSBmcm9tICd1cmwnO1xuaW1wb3J0IHsgYXNzZXJ0UGFnZVVybCB9IGZyb20gJy4uLy4uLy4uL2FwaS90ZXN0LXBhZ2UtdXJsJztcbmltcG9ydCBjaGVja0ZpbGVQYXRoIGZyb20gJy4uLy4uLy4uL3V0aWxzL2NoZWNrLWZpbGUtcGF0aCc7XG5pbXBvcnQgeyBjYXN0QXJyYXkgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgaXNTa2lwSnNFcnJvcnNDYWxsYmFja1dpdGhPcHRpb25zT2JqZWN0IH0gZnJvbSAnLi4vLi4vLi4vYXBpL3NraXAtanMtZXJyb3JzJztcblxuXG4vLyBWYWxpZGF0b3JzXG5leHBvcnQgY29uc3QgaW50ZWdlckFyZ3VtZW50ICAgICAgICAgPSBjcmVhdGVJbnRlZ2VyVmFsaWRhdG9yKEFjdGlvbkludGVnZXJBcmd1bWVudEVycm9yKTtcbmV4cG9ydCBjb25zdCBwb3NpdGl2ZUludGVnZXJBcmd1bWVudCA9IGNyZWF0ZVBvc2l0aXZlSW50ZWdlclZhbGlkYXRvcihBY3Rpb25Qb3NpdGl2ZUludGVnZXJBcmd1bWVudEVycm9yKTtcbmV4cG9ydCBjb25zdCBib29sZWFuQXJndW1lbnQgICAgICAgICA9IGNyZWF0ZUJvb2xlYW5WYWxpZGF0b3IoQWN0aW9uQm9vbGVhbkFyZ3VtZW50RXJyb3IpO1xuZXhwb3J0IGNvbnN0IHNldFNwZWVkQXJndW1lbnQgICAgICAgID0gY3JlYXRlU3BlZWRWYWxpZGF0b3IoU2V0VGVzdFNwZWVkQXJndW1lbnRFcnJvcik7XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGFjdGlvblJvbGVBcmd1bWVudCAobmFtZSwgdmFsKSB7XG4gICAgaWYgKCF2YWwgfHwgIXZhbFtyb2xlTWFya2VyU3ltYm9sXSlcbiAgICAgICAgdGhyb3cgbmV3IEFjdGlvblJvbGVBcmd1bWVudEVycm9yKG5hbWUsIHR5cGVvZiB2YWwpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWN0aW9uT3B0aW9ucyAobmFtZSwgdmFsKSB7XG4gICAgY29uc3QgdHlwZSA9IHR5cGVvZiB2YWw7XG5cbiAgICBpZiAodHlwZSAhPT0gJ29iamVjdCcgJiYgdmFsICE9PSBudWxsICYmIHZhbCAhPT0gdm9pZCAwKVxuICAgICAgICB0aHJvdyBuZXcgQWN0aW9uT3B0aW9uc1R5cGVFcnJvcih0eXBlKTtcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gc3RyaW5nQXJndW1lbnQgKGFyZ3VtZW50LCB2YWwsIGNyZWF0ZUVycm9yKSB7XG4gICAgaWYgKCFjcmVhdGVFcnJvcilcbiAgICAgICAgY3JlYXRlRXJyb3IgPSBhY3R1YWxWYWx1ZSA9PiBuZXcgQWN0aW9uU3RyaW5nQXJndW1lbnRFcnJvcihhcmd1bWVudCwgYWN0dWFsVmFsdWUpO1xuXG4gICAgY29uc3QgdHlwZSA9IHR5cGVvZiB2YWw7XG5cbiAgICBpZiAodHlwZSAhPT0gJ3N0cmluZycpXG4gICAgICAgIHRocm93IGNyZWF0ZUVycm9yKHR5cGUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9uRW1wdHlTdHJpbmdBcmd1bWVudCAoYXJndW1lbnQsIHZhbCwgY3JlYXRlRXJyb3IpIHtcbiAgICBpZiAoIWNyZWF0ZUVycm9yKVxuICAgICAgICBjcmVhdGVFcnJvciA9IGFjdHVhbFZhbHVlID0+IG5ldyBBY3Rpb25TdHJpbmdBcmd1bWVudEVycm9yKGFyZ3VtZW50LCBhY3R1YWxWYWx1ZSk7XG5cbiAgICBzdHJpbmdBcmd1bWVudChhcmd1bWVudCwgdmFsLCBjcmVhdGVFcnJvcik7XG5cbiAgICBpZiAoIXZhbC5sZW5ndGgpXG4gICAgICAgIHRocm93IGNyZWF0ZUVycm9yKCdcIlwiJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBudWxsYWJsZVN0cmluZ0FyZ3VtZW50IChhcmd1bWVudCwgdmFsKSB7XG4gICAgY29uc3QgdHlwZSA9IHR5cGVvZiB2YWw7XG5cbiAgICBpZiAodHlwZSAhPT0gJ3N0cmluZycgJiYgdmFsICE9PSBudWxsKVxuICAgICAgICB0aHJvdyBuZXcgQWN0aW9uTnVsbGFibGVTdHJpbmdBcmd1bWVudEVycm9yKGFyZ3VtZW50LCB0eXBlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhZ2VVcmxBcmd1bWVudCAobmFtZSwgdmFsKSB7XG4gICAgbm9uRW1wdHlTdHJpbmdBcmd1bWVudChuYW1lLCB2YWwpO1xuXG4gICAgYXNzZXJ0UGFnZVVybCh2YWwudHJpbSgpLCAnbmF2aWdhdGVUbycpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RyaW5nT3JTdHJpbmdBcnJheUFyZ3VtZW50IChhcmd1bWVudCwgdmFsKSB7XG4gICAgY29uc3QgdHlwZSA9IHR5cGVvZiB2YWw7XG5cbiAgICBpZiAodHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaWYgKCF2YWwubGVuZ3RoKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEFjdGlvblN0cmluZ09yU3RyaW5nQXJyYXlBcmd1bWVudEVycm9yKGFyZ3VtZW50LCAnXCJcIicpO1xuICAgIH1cblxuICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICBpZiAoIXZhbC5sZW5ndGgpXG4gICAgICAgICAgICB0aHJvdyBuZXcgQWN0aW9uU3RyaW5nT3JTdHJpbmdBcnJheUFyZ3VtZW50RXJyb3IoYXJndW1lbnQsICdbXScpO1xuXG4gICAgICAgIGNvbnN0IHZhbGlkYXRlRWxlbWVudCA9IGVsZW1lbnRJbmRleCA9PiBub25FbXB0eVN0cmluZ0FyZ3VtZW50KFxuICAgICAgICAgICAgYXJndW1lbnQsXG4gICAgICAgICAgICB2YWxbZWxlbWVudEluZGV4XSxcbiAgICAgICAgICAgIGFjdHVhbFZhbHVlID0+IG5ldyBBY3Rpb25TdHJpbmdBcnJheUVsZW1lbnRFcnJvcihhcmd1bWVudCwgYWN0dWFsVmFsdWUsIGVsZW1lbnRJbmRleClcbiAgICAgICAgKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbC5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgIHZhbGlkYXRlRWxlbWVudChpKTtcbiAgICB9XG5cbiAgICBlbHNlXG4gICAgICAgIHRocm93IG5ldyBBY3Rpb25TdHJpbmdPclN0cmluZ0FycmF5QXJndW1lbnRFcnJvcihhcmd1bWVudCwgdHlwZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNpemVXaW5kb3dEZXZpY2VBcmd1bWVudCAobmFtZSwgdmFsKSB7XG4gICAgbm9uRW1wdHlTdHJpbmdBcmd1bWVudChuYW1lLCB2YWwpO1xuXG4gICAgaWYgKCFpc1ZhbGlkRGV2aWNlTmFtZSh2YWwpKVxuICAgICAgICB0aHJvdyBuZXcgQWN0aW9uVW5zdXBwb3J0ZWREZXZpY2VUeXBlRXJyb3IobmFtZSwgdmFsKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNjcmVlbnNob3RQYXRoQXJndW1lbnQgKG5hbWUsIHZhbCkge1xuICAgIG5vbkVtcHR5U3RyaW5nQXJndW1lbnQobmFtZSwgdmFsKTtcblxuICAgIGNvbnN0IGZvcmJpZGRlbkNoYXJzTGlzdCA9IGNoZWNrRmlsZVBhdGgodmFsKTtcblxuICAgIGlmIChmb3JiaWRkZW5DaGFyc0xpc3QubGVuZ3RoKVxuICAgICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuQ2hhcmFjdGVyc0luU2NyZWVuc2hvdFBhdGhFcnJvcih2YWwsIGZvcmJpZGRlbkNoYXJzTGlzdCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmdW5jdGlvbkFyZ3VtZW50IChuYW1lLCB2YWwpIHtcbiAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgdGhyb3cgbmV3IEFjdGlvbkZ1bmN0aW9uQXJndW1lbnRFcnJvcihuYW1lLCB2YWwpO1xufVxuXG5mdW5jdGlvbiBpc1ZhbGlkQ29va2llIChjb29raWUpIHtcbiAgICByZXR1cm4gISFjb29raWUgJiYgKHR5cGVvZiBjb29raWUgPT09ICdvYmplY3QnIHx8IHR5cGVvZiBjb29raWUgPT09ICdzdHJpbmcnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvb2tpZXNBcmd1bWVudCAobmFtZSwgdmFsKSB7XG4gICAgY29uc3QgY29va2llc0xlbmd0aCA9IHZhbC5sZW5ndGg7XG5cbiAgICBmb3IgKGNvbnN0IFtpLCB2YWx1ZV0gb2YgdmFsLmVudHJpZXMoKSkge1xuICAgICAgICBpZiAoIWlzVmFsaWRDb29raWUodmFsdWUpKSB7XG4gICAgICAgICAgICB0aHJvdyBjb29raWVzTGVuZ3RoID09PSAxXG4gICAgICAgICAgICAgICAgPyBuZXcgQWN0aW9uQ29va2llQXJndW1lbnRFcnJvcigpXG4gICAgICAgICAgICAgICAgOiBuZXcgQWN0aW9uQ29va2llQXJndW1lbnRzRXJyb3IoaSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29va2llc0FyZ3VtZW50IChuYW1lLCB2YWwpIHtcbiAgICBpZiAoIXZhbC5sZW5ndGgpXG4gICAgICAgIHRocm93IG5ldyBBY3Rpb25SZXF1aXJlZENvb2tpZUFyZ3VtZW50cygpO1xuXG4gICAgY29va2llc0FyZ3VtZW50KG5hbWUsIHZhbCk7XG59XG5cbmZ1bmN0aW9uIGlzVmFsaWRVcmwgKHVybCkge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBuZXcgVVJMKHVybCkgJiYgdHJ1ZTtcbiAgICB9XG4gICAgY2F0Y2gge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdXJsc0FyZ3VtZW50IChuYW1lLCB2YWwpIHtcbiAgICBjb25zdCBjYXN0VmFsID0gY2FzdEFycmF5KHZhbCk7XG5cbiAgICBmb3IgKGNvbnN0IFtpLCB2YWx1ZV0gb2YgY2FzdFZhbC5lbnRyaWVzKCkpIHtcbiAgICAgICAgaWYgKCFpc1ZhbGlkVXJsKHZhbHVlKSkge1xuICAgICAgICAgICAgdGhyb3cgY2FzdFZhbC5sZW5ndGggPT09IDFcbiAgICAgICAgICAgICAgICA/IG5ldyBBY3Rpb25VcmxDb29raWVBcmd1bWVudEVycm9yKClcbiAgICAgICAgICAgICAgICA6IG5ldyBBY3Rpb25VcmxzQ29va2llQXJndW1lbnRFcnJvcihpLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cmxBcmd1bWVudCAobmFtZSwgdmFsKSB7XG4gICAgY29uc3QgdmFsVHlwZSA9IHR5cGVvZiB2YWw7XG5cbiAgICBpZiAodmFsVHlwZSAhPT0gJ3N0cmluZycgJiYgISh2YWwgaW5zdGFuY2VvZiBVUkwpKVxuICAgICAgICB0aHJvdyBuZXcgQWN0aW9uVXJsQXJndW1lbnRFcnJvcihuYW1lLCB2YWxUeXBlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNraXBKc0Vycm9yT3B0aW9ucyAobmFtZSwgdmFsKSB7XG4gICAgY29uc3QgdmFsVHlwZSA9IHR5cGVvZiB2YWw7XG5cbiAgICBpZiAodmFsVHlwZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsVHlwZSAhPT0gJ29iamVjdCcgJiYgdmFsVHlwZSAhPT0gJ2Jvb2xlYW4nICYmIHZhbFR5cGUgIT09ICdmdW5jdGlvbicpXG4gICAgICAgIHRocm93IG5ldyBBY3Rpb25Ta2lwSnNFcnJvcnNBcmd1bWVudFR5cGVFcnJvcihuYW1lLCB2YWxUeXBlKTtcblxuICAgIGlmIChpc1NraXBKc0Vycm9yc0NhbGxiYWNrV2l0aE9wdGlvbnNPYmplY3QodmFsKSAmJiB2YWwuZGVwZW5kZW5jaWVzICYmIHR5cGVvZiB2YWwuZGVwZW5kZW5jaWVzICE9PSAnb2JqZWN0JylcbiAgICAgICAgdGhyb3cgbmV3IEFjdGlvblNraXBKc0Vycm9yc0RlcGVuZGVuY2llc0FyZ3VtZW50VHlwZUVycm9yKCdkZXBlbmRlbmNpZXMnLCB0eXBlb2YgZGVwZW5kZW5jaWVzKTtcbn1cbiJdfQ==