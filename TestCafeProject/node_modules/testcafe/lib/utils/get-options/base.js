"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const convert_to_best_fit_type_1 = __importDefault(require("../convert-to-best-fit-type"));
const DEFAULT_OPTIONS_SEPARATOR = ',';
const DEFAULT_KEY_VALUE_SEPARATOR = '=';
function convertOptionValueType(value) {
    // NOTE: threat a key without a separator and a value as a boolean flag
    if (value === void 0)
        return true;
    return (0, convert_to_best_fit_type_1.default)(value);
}
function parseOptionsString(optionsStr, optionsSeparator, keyValueSeparator) {
    return optionsStr
        .split(optionsSeparator)
        .map(keyValueString => keyValueString.split(keyValueSeparator))
        .map(([key, ...value]) => [key, value.length > 1 ? value.join(keyValueSeparator) : value[0]]);
}
async function default_1(sourceOptions = '', optionsConfig = {}) {
    const { optionsSeparator = DEFAULT_OPTIONS_SEPARATOR, keyValueSeparator = DEFAULT_KEY_VALUE_SEPARATOR, skipOptionValueTypeConversion = false, onOptionParsed = void 0, } = optionsConfig;
    const optionsList = typeof sourceOptions === 'string' ?
        parseOptionsString(sourceOptions, optionsSeparator, keyValueSeparator) :
        Object.entries(sourceOptions);
    const resultOptions = Object.create(null);
    await Promise.all(optionsList.map(async ([key, value]) => {
        if (!skipOptionValueTypeConversion)
            value = convertOptionValueType(value);
        if (onOptionParsed)
            value = await onOptionParsed(key, value);
        resultOptions[key] = value;
    }));
    return resultOptions;
}
exports.default = default_1;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9nZXQtb3B0aW9ucy9iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMkZBQStEO0FBRy9ELE1BQU0seUJBQXlCLEdBQUssR0FBRyxDQUFDO0FBQ3hDLE1BQU0sMkJBQTJCLEdBQUcsR0FBRyxDQUFDO0FBSXhDLFNBQVMsc0JBQXNCLENBQUUsS0FBVTtJQUN2Qyx1RUFBdUU7SUFDdkUsSUFBSSxLQUFLLEtBQUssS0FBSyxDQUFDO1FBQ2hCLE9BQU8sSUFBSSxDQUFDO0lBRWhCLE9BQU8sSUFBQSxrQ0FBb0IsRUFBQyxLQUFLLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBRSxVQUFrQixFQUFFLGdCQUF3QixFQUFFLGlCQUF5QjtJQUNoRyxPQUFPLFVBQVU7U0FDWixLQUFLLENBQUMsZ0JBQWdCLENBQUM7U0FDdkIsR0FBRyxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQzlELEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdEcsQ0FBQztBQUVjLEtBQUssb0JBQVcsZ0JBQWdFLEVBQUUsRUFBRSxnQkFBd0MsRUFBRTtJQUN6SSxNQUFNLEVBQ0YsZ0JBQWdCLEdBQUcseUJBQXlCLEVBQzVDLGlCQUFpQixHQUFHLDJCQUEyQixFQUMvQyw2QkFBNkIsR0FBRyxLQUFLLEVBQ3JDLGNBQWMsR0FBRyxLQUFLLENBQUMsR0FDMUIsR0FBRyxhQUFhLENBQUM7SUFFbEIsTUFBTSxXQUFXLEdBQUcsT0FBTyxhQUFhLEtBQUssUUFBUSxDQUFDLENBQUM7UUFDbkQsa0JBQWtCLENBQUMsYUFBYSxFQUFFLGdCQUFnQixFQUFFLGlCQUFpQixDQUFDLENBQUMsQ0FBQztRQUN4RSxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBRWxDLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFMUMsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUU7UUFDckQsSUFBSSxDQUFDLDZCQUE2QjtZQUM5QixLQUFLLEdBQUcsc0JBQXNCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFMUMsSUFBSSxjQUFjO1lBQ2QsS0FBSyxHQUFHLE1BQU0sY0FBYyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUU3QyxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQy9CLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFSixPQUFPLGFBQWEsQ0FBQztBQUN6QixDQUFDO0FBekJELDRCQXlCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjb252ZXJ0VG9CZXN0Rml0VHlwZSBmcm9tICcuLi9jb252ZXJ0LXRvLWJlc3QtZml0LXR5cGUnO1xuaW1wb3J0IHsgRGljdGlvbmFyeSwgR2V0T3B0aW9uQ29uZmlndXJhdGlvbiB9IGZyb20gJy4uLy4uL2NvbmZpZ3VyYXRpb24vaW50ZXJmYWNlcyc7XG5cbmNvbnN0IERFRkFVTFRfT1BUSU9OU19TRVBBUkFUT1IgICA9ICcsJztcbmNvbnN0IERFRkFVTFRfS0VZX1ZBTFVFX1NFUEFSQVRPUiA9ICc9JztcblxudHlwZSBPcHRpb25LZXlWYWx1ZSA9IFtzdHJpbmcsIHN0cmluZ107XG5cbmZ1bmN0aW9uIGNvbnZlcnRPcHRpb25WYWx1ZVR5cGUgKHZhbHVlOiBhbnkpOiBhbnkgeyAvKiBlc2xpbnQtZGlzYWJsZS1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkgKi9cbiAgICAvLyBOT1RFOiB0aHJlYXQgYSBrZXkgd2l0aG91dCBhIHNlcGFyYXRvciBhbmQgYSB2YWx1ZSBhcyBhIGJvb2xlYW4gZmxhZ1xuICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgIHJldHVybiBjb252ZXJ0VG9CZXN0Rml0VHlwZSh2YWx1ZSk7XG59XG5cbmZ1bmN0aW9uIHBhcnNlT3B0aW9uc1N0cmluZyAob3B0aW9uc1N0cjogc3RyaW5nLCBvcHRpb25zU2VwYXJhdG9yOiBzdHJpbmcsIGtleVZhbHVlU2VwYXJhdG9yOiBzdHJpbmcpOiBPcHRpb25LZXlWYWx1ZVtdIHtcbiAgICByZXR1cm4gb3B0aW9uc1N0clxuICAgICAgICAuc3BsaXQob3B0aW9uc1NlcGFyYXRvcilcbiAgICAgICAgLm1hcChrZXlWYWx1ZVN0cmluZyA9PiBrZXlWYWx1ZVN0cmluZy5zcGxpdChrZXlWYWx1ZVNlcGFyYXRvcikpXG4gICAgICAgIC5tYXAoKFtrZXksIC4uLnZhbHVlXSkgPT4gW2tleSwgdmFsdWUubGVuZ3RoID4gMSA/IHZhbHVlLmpvaW4oa2V5VmFsdWVTZXBhcmF0b3IpIDogdmFsdWVbMF1dKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gKHNvdXJjZU9wdGlvbnM6IHN0cmluZyB8IERpY3Rpb25hcnk8c3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbj4gPSAnJywgb3B0aW9uc0NvbmZpZzogR2V0T3B0aW9uQ29uZmlndXJhdGlvbiA9IHt9KTogUHJvbWlzZTxEaWN0aW9uYXJ5PGFueT4+IHsgLyogZXNsaW50LWRpc2FibGUtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXG4gICAgY29uc3Qge1xuICAgICAgICBvcHRpb25zU2VwYXJhdG9yID0gREVGQVVMVF9PUFRJT05TX1NFUEFSQVRPUixcbiAgICAgICAga2V5VmFsdWVTZXBhcmF0b3IgPSBERUZBVUxUX0tFWV9WQUxVRV9TRVBBUkFUT1IsXG4gICAgICAgIHNraXBPcHRpb25WYWx1ZVR5cGVDb252ZXJzaW9uID0gZmFsc2UsXG4gICAgICAgIG9uT3B0aW9uUGFyc2VkID0gdm9pZCAwLFxuICAgIH0gPSBvcHRpb25zQ29uZmlnO1xuXG4gICAgY29uc3Qgb3B0aW9uc0xpc3QgPSB0eXBlb2Ygc291cmNlT3B0aW9ucyA9PT0gJ3N0cmluZycgP1xuICAgICAgICBwYXJzZU9wdGlvbnNTdHJpbmcoc291cmNlT3B0aW9ucywgb3B0aW9uc1NlcGFyYXRvciwga2V5VmFsdWVTZXBhcmF0b3IpIDpcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoc291cmNlT3B0aW9ucyk7XG5cbiAgICBjb25zdCByZXN1bHRPcHRpb25zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgIGF3YWl0IFByb21pc2UuYWxsKG9wdGlvbnNMaXN0Lm1hcChhc3luYyAoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIGlmICghc2tpcE9wdGlvblZhbHVlVHlwZUNvbnZlcnNpb24pXG4gICAgICAgICAgICB2YWx1ZSA9IGNvbnZlcnRPcHRpb25WYWx1ZVR5cGUodmFsdWUpO1xuXG4gICAgICAgIGlmIChvbk9wdGlvblBhcnNlZClcbiAgICAgICAgICAgIHZhbHVlID0gYXdhaXQgb25PcHRpb25QYXJzZWQoa2V5LCB2YWx1ZSk7XG5cbiAgICAgICAgcmVzdWx0T3B0aW9uc1trZXldID0gdmFsdWU7XG4gICAgfSkpO1xuXG4gICAgcmV0dXJuIHJlc3VsdE9wdGlvbnM7XG59XG5cbiJdfQ==